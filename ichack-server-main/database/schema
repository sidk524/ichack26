# Schema

## Persistent (Database)

```
user = {
  user_id: string
  role: "civilian" | "first_responder"

  location_history: [{lat, lon, timestamp}]

  calls: [{
    call_id: string
    transcript: string
    start_time: timestamp
    end_time: timestamp
  }]
}

news_article = {
  article_id: string
  link: string
  title: string
  description: string
  lat: float | null
  lon: float | null
  received_at: timestamp
}
```

## Ephemeral (In-memory)

```
active_session = {
  session_id: string
  user_id: string
  start_time: timestamp

  // websocket handles
  location_ws: websocket
  call_ws: websocket

  // buffered state
  location_buffer: [{lat, lon, timestamp}]

  active_call: {
    call_id: string
    start_time: timestamp
    transcript_chunks: [{text, is_final, timestamp}]
  } | null
}
```

On session end: flush `location_buffer` → `user.location_history`, consolidate `active_call.transcript_chunks` → call transcript, persist call to `user.calls`.
